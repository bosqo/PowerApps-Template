---
phase: 04-user-experience-documentation
plan: 03
type: execute
wave: 2
depends_on: [04-01, 04-02]
files_modified:
  - CLAUDE.md
  - docs/QUICK-START.md
  - docs/TOAST-NOTIFICATION-GUIDE.md
  - docs/TROUBLESHOOTING.md
autonomous: true

must_haves:
  truths:
    - "New developer can read inline code comments and understand notification system without external docs"
    - "QUICK-START.md provides 5-step setup guide that enables <30 minute template deployment"
    - "CLAUDE.md has dedicated section explaining notification UDFs and when to use each"
    - "CLAUDE.md includes troubleshooting section addressing 5+ common notification issues"
    - "All code comments follow existing documentation style and are consistent with Phase 1-3 patterns"
    - "Troubleshooting uses symptom-based format (Problem ‚Üí Cause ‚Üí Solution)"
    - "Documentation is targeted at PowerApps developers (assumes connector knowledge, focuses on template-specific config)"
  artifacts:
    - path: "CLAUDE.md"
      provides: "Notification API reference, setup checklist, troubleshooting section"
      min_lines: 100
    - path: "docs/QUICK-START.md"
      provides: "5-step template deployment guide for new projects"
      min_lines: 80
    - path: "docs/TOAST-NOTIFICATION-GUIDE.md"
      provides: "Detailed notification system documentation with examples"
      min_lines: 150
    - path: "docs/TROUBLESHOOTING.md"
      provides: "Symptom-based troubleshooting for common notification issues"
      min_lines: 100
  key_links:
    - from: "CLAUDE.md Notification API section"
      to: "Code comments in App-Formulas-Template.fx"
      via: "reference to source code locations"
      pattern: "See App-Formulas.*line.*NotifySuccess"
    - from: "QUICK-START.md Setup section"
      to: "App-Formulas-Template.fx config placeholders"
      via: "step-by-step configuration guide"
      pattern: "Azure AD group IDs.*lines.*186-217"
    - from: "TROUBLESHOOTING.md"
      to: "Common implementation mistakes"
      via: "symptom-based diagnosis"
      pattern: "Problem.*Cause.*Solution"
---

## Objective

Create comprehensive developer documentation for the notification system and template deployment. This plan bridges the gap between code implementation (04-01, 04-02) and customer project setup, enabling developers to understand the notification system, troubleshoot issues, and deploy the template in new projects within 30 minutes.

**Purpose:** Package the notification system and overall template as production-ready documentation so customers can deploy confidently.

**Output:**
- CLAUDE.md expanded with Notification API reference, setup checklist, and troubleshooting
- QUICK-START.md with 5-step deployment guide (clone ‚Üí configure ‚Üí verify ‚Üí test ‚Üí deploy)
- TOAST-NOTIFICATION-GUIDE.md with detailed notification examples and customization patterns
- TROUBLESHOOTING.md with symptom-based problem diagnosis and solutions

## Execution Context

@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md

## Context

@.planning/ROADMAP.md
@.planning/phases/04-user-experience-documentation/04-CONTEXT.md
@.planning/phases/04-01-SUMMARY.md
@.planning/phases/04-02-SUMMARY.md

Codebase References:
- @CLAUDE.md (existing, will expand)
- @src/App-Formulas-Template.fx (notification UDFs, lines 859-900+)
- @src/App-OnStart-Minimal.fx (Section 7: notification state)
- @src/Control-Patterns-Modern.fx (toast patterns)

## Tasks

<task type="auto">
  <name>Task 1: Expand CLAUDE.md with Notification System API reference and usage guide</name>
  <files>CLAUDE.md</files>
  <action>
Expand CLAUDE.md to include notification system documentation. Add new section after "Performance Best Practices" section:

**New Section: Notification System (400-500 words)**

Location: After line 300 (end of Performance section), before deployment section

Content structure:

1. **Section Header (lines 305-315):**
   - "## Notification System (Phase 4)"
   - Brief intro: "Toast notifications provide non-blocking, Fluent Design-compliant feedback for user actions"
   - Purpose: "Use for form submissions, validation errors, approval actions, and success confirmations"

2. **Notification UDFs - Public API (lines 320-370):**

   Table showing all notification UDFs:
   ```
   | UDF | Type | Usage | Auto-Dismiss |
   |-----|------|-------|--------------|
   | NotifySuccess(msg) | Info | Record saved, action completed | 5s |
   | NotifyError(msg) | Error | Save failed, permission denied | Manual (X button) |
   | NotifyWarning(msg) | Warning | Validation failure, confirmation needed | 5s |
   | NotifyInfo(msg) | Info | Status updates, informational messages | 5s |
   | NotifyPermissionDenied(action) | Error | User lacks permission for action | Manual |
   | NotifyActionCompleted(action, name) | Success | Action finished (e.g., "Delete completed: Item 1") | 5s |
   | NotifyValidationError(field, msg) | Warning | Form field validation failed | 5s |
   ```

   For each UDF, document:
   - Purpose (one sentence)
   - Parameters (with descriptions)
   - Return type (Void - side effects only)
   - When to use (specific scenarios)
   - Example call
   - Note: Never call `Notify()` directly; use these UDFs instead

3. **Code Examples (lines 375-420):**

   Example 1: Form submission success
   ```powerfx
   btn_SaveRecord.OnSelect =
   If(
       IsValid(form_EditRecord),
       Patch(Items, ThisItem, form_EditRecord.Updates);
       NotifySuccess("Record saved successfully"),
       NotifyValidationError("Form", "Please complete all required fields")
   )
   ```

   Example 2: Delete with confirmation
   ```powerfx
   btn_DeleteRecord.OnSelect =
   If(
       Confirm("Delete this record permanently?"),
       IfError(
           Remove(Items, ThisItem);
           NotifyActionCompleted("Delete", ThisItem.Name),
           NotifyError("Failed to delete: " & Error.Message)
       )
   )
   ```

   Example 3: Custom notification
   ```powerfx
   // If you need custom message, type, or timing:
   AddToast("Custom notification", "Info", true, 5000)
   // Parameters: message, type ("Success"/"Error"/"Warning"/"Info"), autoClose, duration(ms)
   ```

4. **Toast Lifecycle (lines 425-450):**

   Diagram/explanation:
   - "Call NotifySuccess() or related UDF"
   - "‚Üí UDF calls AddToast() internally"
   - "‚Üí AddToast adds row to NotificationStack collection"
   - "‚Üí UI layer renders toast in top-right corner"
   - "‚Üí If AutoClose=true: Toast fades and disappears after duration (default 5s)"
   - "‚Üí If AutoClose=false: Toast persists until user clicks X button"

5. **Configuration (lines 455-475):**

   ToastConfig reference:
   - Width: 350px (adjust in App-Formulas-Template.fx line XX if needed)
   - SuccessDuration: 5000ms (change in ToastConfig if needed)
   - ErrorDuration: 0ms (errors never auto-dismiss)
   - AnimationDuration: 300ms (slide-in/fade-out speed)

   How to customize:
   - Change durations: Edit ToastConfig in App-Formulas-Template.fx
   - Change colors: Edit GetToastBackground() UDF to return different ThemeColors
   - Change icons: Edit GetToastIcon() UDF to use different Unicode characters
   - Example: "To make errors auto-dismiss after 10s, change ErrorDuration: 10000 in ToastConfig"

6. **Best Practices (lines 480-500):**
   - Always use specific UDF (NotifySuccess vs NotifyError) for correct styling
   - Errors should describe problem and solution ("Failed to save: Check network connection")
   - Keep messages brief (one sentence, <80 characters ideally)
   - Don't show sensitive information in toasts (user emails, database IDs)
   - For long operations (>5s), disable button during operation and show progress indicator
   - Group related notifications (don't spam 10 toasts for one action)

7. **Common Issues & Fixes (lines 505-520):**
   - "Toasts don't appear?" ‚Üí Check NotificationStack collection initialized in App.OnStart
   - "Toast blocks content?" ‚Üí Check cnt_NotificationStack ZIndex=1000 (should be highest)
   - "Toasts overlap?" ‚Üí Check container Spacing property = 12px
   - "Auto-dismiss not working?" ‚Üí Check ThisItem.AutoClose = true in Visible formula
   - See TROUBLESHOOTING.md for more detailed diagnosis

All documentation should reference exact line numbers in source files for quick navigation.
  </action>
  <verify>
Open CLAUDE.md and verify:
1. New "Notification System" section exists after Performance section
2. All 7 notification UDFs documented in table format
3. 3 working code examples present (form save, delete, custom)
4. Toast lifecycle explained (5 steps minimum)
5. Configuration section shows how to customize durations/colors/icons
6. Best practices section has 5-7 bullet points
7. Common issues section references TROUBLESHOOTING.md
8. All line number references accurate (check that lines actually contain referenced code)
9. No broken code examples (syntax correct for Power Fx)
10. Tone matches existing CLAUDE.md sections (friendly, practical, not jargony)
  </verify>
  <done>CLAUDE.md expanded with comprehensive notification API reference, includes usage examples, configuration guide, best practices, and common issues section, all line references accurate</done>
</task>

<task type="auto">
  <name>Task 2: Create QUICK-START.md with 5-step template deployment guide</name>
  <files>docs/QUICK-START.md</files>
  <action>
Create new file: docs/QUICK-START.md with 5-step quick-start guide for new customer projects. Target audience: PowerApps developers who know connectors but are new to this template.

File structure (350-400 words total):

**Header (lines 1-20):**
```markdown
# Quick Start: PowerApps Canvas App Template

**Target:** Deploy working template to new customer project in <30 minutes
**Audience:** PowerApps developers familiar with connectors and Power Fx
**Assumptions:** You have access to a customer's Dataverse or SharePoint environment

## What You Get

- Named Formulas for user profile, roles, permissions (auto-calculated, reactive)
- Delegation-friendly filter UDFs for 2000+ record datasets
- Toast notification system with Fluent Design styling
- Gallery patterns with pagination for 500+ records
- Performance-optimized App.OnStart (<2 seconds)

See [CLAUDE.md](../CLAUDE.md) for complete feature list.
```

**Step 1: Clone/Copy Template Files (lines 25-50)**
```markdown
## Step 1: Clone Template Files (2 min)

1. Copy template files to your project:
   - `src/App-Formulas-Template.fx` ‚Üí Your app's formulas section
   - `src/App-OnStart-Minimal.fx` ‚Üí Your app's App.OnStart
   - `src/Control-Patterns-Modern.fx` ‚Üí Copy patterns you need

2. In Power Apps Studio:
   - Select your canvas app
   - Open Advanced editor (Ctrl+Shift+X)
   - Paste formulas into corresponding sections

3. Fix import errors:
   - Blue squiggles on Dataverse/SharePoint connectors? Click ‚Üí "Add data"
   - Missing collections? Check Step 2 (connect data sources)
```

**Step 2: Connect Required Data Sources (lines 55-85)**
```markdown
## Step 2: Connect Data Sources (5 min)

1. Add these connectors to your app:
   - **Office365Users** - For user profile (required for roles/permissions)
   - **Office365Groups** - For Azure AD group membership (required for roles)
   - **SharePoint Lists** or **Dataverse** - For your app data

2. Add these tables as data sources:
   - Departments (SharePoint/Dataverse) - columns: Name, Status
   - Categories (SharePoint/Dataverse) - columns: Name, Status
   - Items (your main data table) - columns: Owner, Status, Modified On
   - (Add others as your app needs)

3. In Power Apps Studio:
   - Select Data ‚Üí Connectors
   - Search for "Office365Users" ‚Üí Connect
   - Search for "Office365Groups" ‚Üí Connect
   - Add your SharePoint/Dataverse tables

4. Verify in formula bar:
   - Type: Office365Users.MyProfileV2() ‚Üí Should return your profile
   - Type: Items ‚Üí Should show your table
```

**Step 3: Configure Azure AD Group IDs (lines 90-125)**
```markdown
## Step 3: Configure Azure AD Group IDs (5 min)

The template uses Azure AD groups to determine user roles (Admin, Manager, HR, etc.).

1. Find your group IDs in Azure Portal:
   - Go to https://portal.azure.com ‚Üí Azure Active Directory ‚Üí Groups
   - Find groups for your organization (e.g., "Sales Team", "Managers")
   - Copy group ID (not group name) for each role

2. In Power Apps, open formulas and find `App-Formulas-Template.fx`:
   - Scroll to "UserRoles" Named Formula (around line 186)
   - You'll see placeholder group IDs:
   ```
   AdminGroupId: "00000000-0000-0000-0000-000000000001",  // TODO: Replace with your group ID
   ManagerGroupId: "00000000-0000-0000-0000-000000000002",  // TODO: Replace
   ```

3. Replace each placeholder with actual group IDs from Step 1

4. Verify: Ask a manager to login - they should see admin features if in Manager group

**Note:** If you don't have Azure AD groups, set group IDs to "invalid-id-for-testing" and add yourself to all roles temporarily for demo purposes. See [TROUBLESHOOTING.md](#roles-empty-or-all-false) for details.
```

**Step 4: Verify Setup (lines 130-160)**
```markdown
## Step 4: Verify Setup (3 min)

1. Save and reload the app (Ctrl+R)
2. Open Power Apps Monitor (F12 in browser, or Ctrl+Shift+X in Studio)
3. Check:
   - [ ] App loads without errors (Monitor shows no red errors)
   - [ ] Startup time <2000ms (Monitor ‚Üí Performance)
   - [ ] UserProfile populated (Monitor ‚Üí Collections ‚Üí Check for profile data)
   - [ ] NotificationStack collection exists and is empty (Monitor ‚Üí Collections)
   - [ ] Galleries show data (no empty placeholders)

If something fails, see [TROUBLESHOOTING.md](./TROUBLESHOOTING.md)
```

**Step 5: Test & Deploy (lines 165-185)**
```markdown
## Step 5: Test & Deploy (3 min)

1. Test a complete user flow:
   - Add a record (form submission) ‚Üí Should see green "Saved" toast notification
   - Edit the record ‚Üí Toast appears on save
   - Delete (if allowed) ‚Üí Toast appears
   - Search/filter galleries ‚Üí Should show filtered results
   - Try action without permission ‚Üí Should see red error toast

2. Share app with team:
   - Power Apps Studio ‚Üí Share button
   - Add user emails or security groups
   - Set permission (Viewer, Editor, Owner)

3. Monitor for issues:
   - Check Monitor tool regularly for errors
   - Collect user feedback on performance
   - Adjust gallery pagination (Step 500-record limit default) if needed

4. Next steps:
   - Customize gallery columns for your data
   - Add approval workflows
   - Connect to Power Automate flows for email/notifications
   - See [CLAUDE.md](../CLAUDE.md) for customization patterns

---

**Stuck?** See [TROUBLESHOOTING.md](./TROUBLESHOOTING.md)
```

**Footer (lines 190-200):**
```markdown
## Quick Reference

- **Performance target:** <2000ms startup, <500ms page navigation
- **Gallery limit:** 500+ records with pagination (FirstN/Skip pattern)
- **Delegation:** All filters work with 2000+ record SharePoint lists
- **Notifications:** See [CLAUDE.md - Notification System](../CLAUDE.md#notification-system)
- **Documentation:** [CLAUDE.md](../CLAUDE.md) for architecture, [TROUBLESHOOTING.md](./TROUBLESHOOTING.md) for issues

Version: 1.0 (Phase 4, 2026-01-19)
```

Total lines: ~200 lines, covering all 5 steps with code examples and checklists.
  </action>
  <verify>
Create docs/QUICK-START.md and verify:
1. File exists at docs/QUICK-START.md
2. All 5 steps present with clear numbering
3. Each step has estimated time (2, 5, 5, 3, 3 min = 18 total min target)
4. Step 2 lists all required connectors and data sources
5. Step 3 includes Azure AD group ID setup with placeholder examples
6. Step 4 has verification checklist with 5+ items
7. Step 5 includes test scenarios (add, edit, delete, search, permission)
8. All code examples syntactically correct for Power Fx
9. Cross-references to CLAUDE.md and TROUBLESHOOTING.md present
10. Tone is friendly and assumes intermediate PowerApps knowledge (not basics)
  </verify>
  <done>QUICK-START.md created with complete 5-step deployment guide, estimated <30 minute completion, includes verification checklist and test scenarios</done>
</task>

<task type="auto">
  <name>Task 3: Create TOAST-NOTIFICATION-GUIDE.md with detailed notification examples and customization patterns</name>
  <files>docs/TOAST-NOTIFICATION-GUIDE.md</files>
  <action>
Create new file: docs/TOAST-NOTIFICATION-GUIDE.md with comprehensive notification documentation for developers who want to understand the system deeply and customize it.

File structure (400-500 words):

**Header (lines 1-25):**
```markdown
# Toast Notification System Guide

**Purpose:** Understand how notifications work, when to use each type, and how to customize behavior
**Audience:** PowerApps developers implementing app features that need user feedback
**Related:** [QUICK-START.md](./QUICK-START.md), [CLAUDE.md - Notification API](../CLAUDE.md#notification-system)

## When to Use Notifications

| Scenario | UDF | Auto-Dismiss | Example |
|----------|-----|--------------|---------|
| Record saved, action completed | NotifySuccess | Yes (5s) | "Record saved" |
| Required field missing, invalid data | NotifyWarning | Yes (5s) | "Email format invalid" |
| Save failed, no permission, server error | NotifyError | No (manual X) | "Failed to save: Check network" |
| Status update, informational message | NotifyInfo | Yes (5s) | "Loading data..." |
```

**Architecture Section (lines 30-80):**
```markdown
## How Notifications Work

Three layers:

**Layer 1: Trigger UDFs (App-Formulas-Template.fx)**
```powerfx
NotifySuccess(message: Text): Void = {
    Notify(message, NotificationType.Success);  // System banner
    AddToast(message, "Success", true, 5000)    // Custom toast
};
```
Developer calls this. UDF handles both system notification and custom toast.

**Layer 2: State Management (App-OnStart, App-Formulas)**
```powerfx
AddToast(message, type, autoClose, duration): Void = {
    // Adds row to NotificationStack collection
    Patch(NotificationStack, Defaults(NotificationStack), {
        ID: NotificationCounter,
        Message: message,
        Type: type,        // "Success", "Error", "Warning", "Info"
        AutoClose: autoClose,
        Duration: duration,
        CreatedAt: Now(),
        IsVisible: true
    });
    // Increments counter for next unique ID
    Set(NotificationCounter, NotificationCounter + 1);
};
```
Internal helper. Maintains NotificationStack collection.

**Layer 3: UI Rendering (Control-Patterns-Modern.fx)**
- Container: cnt_NotificationStack (top-right, fixed overlay)
- Child tiles: cnt_Toast (repeats for each row in NotificationStack)
- Styling: Dynamic colors via GetToastBackground(Type)
- Close button: RemoveToast(ID) on click
- Auto-dismiss: Opacity fades when 4.7s elapsed, Visible=false at 5s
```

**Usage Examples (lines 85-180):**

Section 2.1: Basic Form Submission (lines 90-110)
```powerfx
btn_SaveRecord.OnSelect =
If(
    IsValid(form_EditRecord),
    // Validation passed - save
    IfError(
        Patch(Items, ThisItem, form_EditRecord.Updates);
        Refresh(Items);
        NotifySuccess("Record saved successfully");
        Navigate(ListScreen),
        // Save failed
        NotifyError("Save failed: " & Error.Message)
    ),
    // Validation failed
    NotifyValidationError("Form", "Please complete all required fields")
)
```

Section 2.2: Delete with Confirmation (lines 115-135)
```powerfx
btn_DeleteRecord.OnSelect =
If(
    Confirm("Delete this record permanently?"),
    IfError(
        Remove(Items, ThisItem);
        NotifyActionCompleted("Delete", ThisItem.Name),
        NotifyError("Delete failed: " & Error.Message)
    ),
    NotifyInfo("Delete cancelled")
)
```

Section 2.3: Approval Workflow (lines 140-160)
```powerfx
btn_ApproveRecord.OnSelect =
If(
    HasPermission("Approve"),
    Patch(Items, ThisItem, {Status: "Approved"});
    NotifySuccess("Record approved");
    // Optional: Send email via Power Automate
    SendApprovalEmail(ThisItem.Name),
    NotifyPermissionDenied("approve records")
)
```

Section 2.4: Long-Running Operation (lines 165-185)
```powerfx
// Disable button during long operation
btn_BulkUpdate.OnSelect =
If(
    AppState.IsProcessing,
    NotifyWarning("Operation in progress..."),
    // Start operation
    Set(AppState, Patch(AppState, {IsProcessing: true}));
    NotifyInfo("Processing started - this may take a moment");
    // Call Power Automate flow
    BulkUpdateFlow.Run(...);
    // Flow calls back to app when done
    Set(AppState, Patch(AppState, {IsProcessing: false}));
    NotifySuccess("Bulk update completed")
)
```

**Customization (lines 190-250):**
```markdown
## How to Customize Notifications

### Change Auto-Dismiss Timeout

Edit `ToastConfig` in App-Formulas-Template.fx (line ~XX):
```powerfx
ToastConfig = {
    SuccessDuration: 5000,  // Change to 3000 for 3 seconds
    WarningDuration: 5000,  // Change if needed
    ErrorDuration: 0,       // Never change this (errors always manual)
}
```

### Change Toast Colors

Edit `GetToastBackground()` UDF in App-Formulas-Template.fx (line ~XX):
```powerfx
GetToastBackground(toastType: Text): Color =
    Switch(
        toastType,
        "Success", ColorValue("#98D08C"),  // Change green to custom color
        "Error", ColorValue("#C5504B"),    // Change red
        ...
    )
```

### Change Toast Icons

Edit `GetToastIcon()` UDF (line ~XX):
```powerfx
GetToastIcon(toastType: Text): Text =
    Switch(
        toastType,
        "Success", "üëç",  // Change from ‚úì to thumbs-up emoji
        ...
    )
```

### Add New Notification Type

1. Add new case to GetToastBackground() UDF
2. Add new case to GetToastIcon() UDF
3. Add new case to GetToastIconColor() UDF
4. Create new UDF, e.g.: NotifyDebug(msg) = { ... AddToast(msg, "Debug", ...) }
5. Use new UDF: NotifyDebug("Debugging info")

### Show Custom Notification (Advanced)

Skip the UDF wrapper and call AddToast directly:
```powerfx
AddToast("Custom message", "Success", true, 8000)
// Parameters: message, type (must match GetToast* cases), autoClose, duration(ms)
```

---

**Troubleshooting:** See [TROUBLESHOOTING.md](./TROUBLESHOOTING.md)
```

Total lines: ~250 lines with comprehensive examples, architecture explanation, and customization patterns.
  </action>
  <verify>
Create docs/TOAST-NOTIFICATION-GUIDE.md and verify:
1. File exists at docs/TOAST-NOTIFICATION-GUIDE.md
2. Usage table (4 scenarios) present at top
3. Architecture section explains 3 layers with code snippets
4. 4 detailed usage examples (form save, delete, approval, long-running)
5. Customization section covers: durations, colors, icons, custom types
6. All code examples are syntactically correct Power Fx
7. Cross-references to other docs present
8. No typos or formatting issues in code blocks
9. Tone is educational (explains "why", not just "what")
10. Examples are realistic and match common PowerApps patterns
  </verify>
  <done>TOAST-NOTIFICATION-GUIDE.md created with comprehensive documentation, real-world examples, customization patterns, and architecture explanation</done>
</task>

<task type="auto">
  <name>Task 4: Create TROUBLESHOOTING.md with symptom-based problem diagnosis</name>
  <files>docs/TROUBLESHOOTING.md</files>
  <action>
Create new file: docs/TROUBLESHOOTING.md with symptom-based troubleshooting guide for common notification issues.

File structure (400-500 words):

**Header (lines 1-20):**
```markdown
# Troubleshooting: Toast Notifications

**How to use this guide:** Find your problem symptom on the left, follow the diagnosis steps, apply the solution.

Related: [QUICK-START.md](./QUICK-START.md), [CLAUDE.md](../CLAUDE.md), [TOAST-NOTIFICATION-GUIDE.md](./TOAST-NOTIFICATION-GUIDE.md)
```

**Problem 1: Toasts Don't Appear (lines 25-60)**
```markdown
## Problem 1: I Called NotifySuccess() But No Toast Appears

### Symptoms
- Formula bar shows NotifySuccess("Test") executed (no errors)
- Power Apps system notification banner appears (the gray bar at top)
- But custom toast in top-right corner doesn't appear
- App seems to work otherwise (no errors in Monitor)

### Diagnosis
1. Open Monitor (F12 in browser, or Ctrl+Shift+X in Studio)
2. Go to Collections tab
3. Look for "NotificationStack" collection
   - NOT FOUND? ‚Üí Cause is missing initialization (step 5a below)
   - FOUND but empty after calling NotifySuccess? ‚Üí Cause is missing container (step 5b)
   - FOUND with rows? ‚Üí Cause is hidden/off-screen container (step 5c)

### Solutions

**5a. NotificationStack collection not initialized:**
```powerfx
// In App.OnStart, Section 7 (Notification Stack), verify:
ClearCollect(NotificationStack, Table());  // This line must exist
```
If missing, add it. If present but failing, check for typo in collection name.

**5b. Container not added to screen:**
- In tree view (left side), look for container named "cnt_NotificationStack"
- If missing: Add a new Vertical Container to your main screen (add it LAST so it renders on top)
- If present: Continue to 5c

**5c. Container hidden or off-screen:**
- Right-click cnt_NotificationStack ‚Üí Edit properties
- Check Visible property: Should be `CountRows(NotificationStack) > 0` or `true`
- If shows `false` or a formula that evaluates to false, change to `true` or fix formula
- Check X property: Should be around `Parent.Width - 400` (positions at right edge)
- Check Y property: Should be around `16` (top of screen)
- If X=0 and Y=0, container is off-screen at wrong position

**5d. Check formula bar for typos:**
- Call `NotifySuccess("Test")` in formula bar
- Check Monitor again: NotificationStack should now have 1 row
- If still 0 rows, verify NotifySuccess UDF calls AddToast (not just Notify)
```

**Problem 2: Toasts Block Content / Z-Index Issue (lines 65-95)**
```markdown
## Problem 2: Toast Appears But I Can't Click Buttons Behind It

### Symptoms
- Toast notification appears in top-right
- When I try to click a form field or button behind the toast, toast area gets the click instead
- Toast seems to be blocking interaction with app content

### Diagnosis
1. Right-click toast container (cnt_NotificationStack) ‚Üí Edit properties
2. Check ZIndex property
   - If ZIndex < 100: Not high enough (other controls in front)
   - If ZIndex = 1000: OK, but might still have issues due to parent container

### Solutions

**2a. Set container ZIndex to highest value:**
```powerfx
// In cnt_NotificationStack properties:
ZIndex: 1000  // Change to this if different
```

**2b. Check parent container ClipContents:**
- If cnt_NotificationStack is inside another container (cnt_MainContent, etc.)
- Open parent container ‚Üí Edit properties ‚Üí ClipContents property
- If ClipContents = true: Change to false (allows child toast to appear on top)
- If ClipContents already false: Issue might be layering, continue to 2c

**2c. Move container to end of children list:**
- In tree view, drag cnt_NotificationStack to be the LAST child of its parent
- Last child renders on top of earlier children
- Re-test: Toast should now appear in front

**2d. Verify toast isn't capturing clicks:**
- Toast itself shouldn't have any OnSelect handlers
- Close button (X) should only call RemoveToast, nothing else
- If toast has other click handlers, remove them
```

**Problem 3: Multiple Toasts Overlap (lines 100-130)**
```markdown
## Problem 3: When I Show Multiple Toasts, They Stack On Top Of Each Other

### Symptoms
- I call NotifySuccess(), NotifyWarning(), NotifyError() in sequence
- All toasts appear but they overlap (write on top of each other)
- Can't see message text clearly
- Spacing between toasts missing

### Diagnosis
1. Open cnt_NotificationStack properties
2. Check LayoutMode property: Should be `LayoutMode.Vertical`
3. Check Spacing property: Should be `12` (pixels between children)

### Solutions

**3a. Fix LayoutMode:**
```powerfx
// In cnt_NotificationStack properties:
LayoutMode: LayoutMode.Vertical  // Automatic top-to-bottom stacking
```

**3b. Fix Spacing:**
```powerfx
// In cnt_NotificationStack properties:
Spacing: 12  // Gap between toasts (in pixels)
```

**3c. Check child toast (cnt_Toast) height:**
- Open individual toast container (cnt_Toast) properties
- Height should be `Auto` (let content determine height)
- If Height = fixed pixel value (e.g., 50), change to `Auto`

**3d. Clear Padding if causing issues:**
- cnt_NotificationStack should have Padding: 8
- If you increased padding thinking it adds space between toasts, reduce back to 8
- Use Spacing property for gaps between items, not Padding
```

**Problem 4: Error Toasts Auto-Dismiss When I'm Still Reading (lines 135-165)**
```markdown
## Problem 4: Error Toast Disappears After 5 Seconds (I Need Longer)

### Symptoms
- Call NotifyError("Something failed")
- Toast appears for a few seconds then disappears
- I want errors to stay visible until I click X button

### Diagnosis
1. Error messages must NEVER auto-dismiss (they require intentional user action)
2. Check NotifyError UDF in App-Formulas-Template.fx (line ~XX)

### Solutions

**4a. Verify NotifyError doesn't auto-close:**
```powerfx
// In NotifyError UDF, should be:
NotifyError(message: Text): Void = {
    Notify(message, NotificationType.Error);
    AddToast(message, "Error", false, 0)  // false = don't auto-close, 0 = no duration
};

// If you see "true" instead of "false", change it to false
```

**4b. Verify ToastConfig has ErrorDuration = 0:**
```powerfx
// In ToastConfig Named Formula (line ~XX), check:
ErrorDuration: 0  // Should be 0, not 5000 or any other value
```

**4c. Check cnt_Toast Visible formula:**
```powerfx
// In cnt_Toast.Visible property, should include logic like:
If(ThisItem.AutoClose && elapsed > 5s, false, true)

// This checks AutoClose flag - if false (errors), stays visible
```

**4d: If error still auto-dismisses:**
- Check if you're calling NotifyError() or AddToast() directly
- If calling AddToast() directly: Make sure shouldAutoClose parameter = false
- Example: `AddToast(message, "Error", false, 0)`  ‚Üê false = don't auto-close
```

**Problem 5: NotificationStack Collection Grows Unbounded (lines 170-200)**
```markdown
## Problem 5: After Showing Many Toasts, App Gets Slow (NotificationStack Has 100+ Rows)

### Symptoms
- Show several toasts (10+)
- Monitor shows NotificationStack has 100+ rows after 30 minutes of use
- App feels sluggish (slower to navigate, galleries lag)
- Expected: Old toasts auto-removed when no longer needed

### Diagnosis
1. Open Monitor ‚Üí Collections tab
2. Expand NotificationStack and count rows
   - Expected: 0-5 rows at any time
   - Actual: 50+ rows, many with CreatedAt from hours ago
3. Cause: Auto-dismiss not removing old toasts, RemoveToast() not called

### Solutions

**5a. Verify auto-dismiss is working:**
1. Call NotifySuccess("Timer test")
2. Wait 5 seconds
3. Check Monitor: NotificationStack should have 0 rows (toast auto-removed)
4. If still 1 row: Auto-dismiss not working, go to 5b

**5b. Check auto-dismiss formula in cnt_Toast:**
```powerfx
// In cnt_Toast.Visible property, look for something like:
If(ThisItem.AutoClose && Now() - ThisItem.CreatedAt > TimeValue("0:0:5"), false, true)

// If formula is missing or wrong, toasts never hide
// The 0:0:5 = 5 seconds
```

**5c. Force cleanup (manual workaround):**
```powerfx
// Run this in formula bar as temporary fix:
ForAll(
    Filter(NotificationStack, Now() - CreatedAt > TimeValue("0:0:30")),
    Remove(NotificationStack, @Value)
)
// This removes toasts older than 30 seconds (manual cleanup)
```

**5d. Check if RemoveToast is working:**
1. Add a toast
2. Click X button on the toast
3. Monitor should show collection decreased by 1 row
4. If row still there: Click handler not calling RemoveToast properly

**Solution:** Verify btn_CloseToast.OnSelect = RemoveToast(ThisItem.ID)
```

**Problem 6: Toasts Appear But With Wrong Colors/Icons (lines 205-230)**
```markdown
## Problem 6: Toast Shows But Icon Or Color Is Wrong

### Symptoms
- Success toast appears green (correct) but checkmark shows as "?" or blank
- Error toast shows as blue instead of red
- Warning icon appears as wrong symbol

### Diagnosis
1. Check GetToastIcon() and GetToastBackground() UDFs
2. Verify they have cases for all types: "Success", "Error", "Warning", "Info"

### Solutions

**6a. Verify GetToastIcon has all types:**
```powerfx
GetToastIcon(toastType: Text): Text =
    Switch(
        toastType,
        "Success", "‚úì",      // Must have case for "Success"
        "Error", "‚úï",        // Must have case for "Error"
        "Warning", "‚ö†",      // Must have case for "Warning"
        "Info", "‚Ñπ",         // Must have case for "Info"
        ""                   // Fallback
    )
```

**6b. Verify GetToastBackground has all types:**
```powerfx
GetToastBackground(toastType: Text): Color =
    Switch(
        toastType,
        "Success", ThemeColors.SuccessLight,
        "Error", ThemeColors.ErrorLight,
        "Warning", ThemeColors.WarningLight,
        "Info", ColorValue("#E7F4FF"),
        ThemeColors.Surface  // Fallback
    )
```

**6c: If icons show as "?" character:**
- Unicode characters might not be supported in your font
- Replace "‚úì" with check mark emoji "‚úÖ" or text "[OK]"
- Replace "‚úï" with "‚ùå" or text "[ERROR]"
- Replace "‚ö†" with "‚ö†Ô∏è" or text "[WARNING]"

**6d: If colors wrong:**
- Verify ThemeColors Named Formula has SuccessLight, ErrorLight, WarningLight, Info
- If missing, define them in App-Formulas-Template.fx
- Example: `SuccessLight: ColorValue("#E8F5E9")  // Light green`
```

**Footer (lines 235-250):**
```markdown
---

## Still Stuck?

1. Check [QUICK-START.md Setup verification](./QUICK-START.md#step-4-verify-setup) checklist
2. Open Monitor (F12) and check for error messages
3. Review [TOAST-NOTIFICATION-GUIDE.md](./TOAST-NOTIFICATION-GUIDE.md) architecture section
4. Post issue with:
   - Screenshot of Monitor (Collections tab showing NotificationStack)
   - Code snippet of your NotifySuccess/NotifyError call
   - Expected vs actual behavior

**Last resort:** Restart Power Apps (close browser tab and reopen)
```

Total lines: ~250 lines with 6 detailed problem scenarios and multiple solutions per scenario.
  </action>
  <verify>
Create docs/TROUBLESHOOTING.md and verify:
1. File exists at docs/TROUBLESHOOTING.md
2. At least 6 distinct problems documented
3. Each problem has: Symptoms, Diagnosis, Solutions sections
4. All solutions include code examples or step-by-step instructions
5. Solutions reference specific line numbers in source files (when applicable)
6. Cross-references to QUICK-START.md and other docs present
7. No typos or formatting issues
8. Code examples are accurate Power Fx
9. Tone is helpful and non-judgmental (acknowledges common mistakes)
10. Footer includes "still stuck" guidance
  </verify>
  <done>TROUBLESHOOTING.md created with symptom-based diagnosis for 6+ common notification issues, includes solution code and step-by-step instructions</done>
</task>

<task type="auto">
  <name>Task 5: Add inline code comments to App-Formulas-Template.fx and Control-Patterns documenting notification system for developers</name>
  <files>src/App-Formulas-Template.fx, src/Control-Patterns-Modern.fx</files>
  <action>
Add comprehensive inline comments to source code files explaining notification system architecture and patterns for developers reading code directly.

**In App-Formulas-Template.fx (lines 878-885, before ToastConfig):**

Add 12-15 line architecture comment block:
```powerfx
// -----------------------------------------------------------
// TOAST NOTIFICATION SYSTEM (Phase 4)
// -----------------------------------------------------------
// Three-layer notification system for non-blocking, Fluent Design feedback
//
// Layer 1: Trigger UDFs (this file)
//   - NotifySuccess(), NotifyError(), NotifyWarning(), NotifyInfo()
//   - Developers call these; never call Notify() or AddToast() directly
//   - Each UDF calls AddToast() to update NotificationStack collection
//
// Layer 2: State Management (this file + App.OnStart)
//   - ToastConfig: Configuration (durations, dimensions)
//   - AddToast/RemoveToast: Lifecycle UDFs
//   - NotificationStack: Collection holding active toasts
//   - See App.OnStart Section 7 for initialization
//
// Layer 3: UI Rendering (Control-Patterns-Modern.fx Section 1.9)
//   - cnt_NotificationStack: Main container (top-right overlay)
//   - cnt_Toast: Individual toast tile (repeating child)
//   - GetToast* helpers: Dynamic styling (colors, icons per type)
//
// Example flow: NotifySuccess("Saved") ‚Üí AddToast ‚Üí NotificationStack row ‚Üí UI renders
// For customization guide, see docs/TOAST-NOTIFICATION-GUIDE.md
// For troubleshooting, see docs/TROUBLESHOOTING.md
```

**In App-Formulas-Template.fx (lines 955-960, after GetToastIcon):**

Add 8-10 line comment on lifecycle UDFs:
```powerfx
// -----------------------------------------------------------
// Notification Lifecycle: AddToast & RemoveToast
// -----------------------------------------------------------
// AddToast: Called by NotifySuccess/NotifyError/etc (Layer 1 ‚Üí Layer 2)
//   ‚Üí Adds row to NotificationStack (Layer 2 state)
//   ‚Üí UI layer (Layer 3) automatically renders new row
//
// RemoveToast: Called by UI close button or auto-dismiss timer (Layer 3 ‚Üí Layer 2)
//   ‚Üí Removes row from NotificationStack
//   ‚Üí UI layer automatically updates (row no longer exists)
//
// Never call these directly in controls; they are implementation details.
// Always use NotifySuccess(), NotifyError(), etc. for user-facing notifications.
```

**In Control-Patterns-Modern.fx (lines 510-525, before cnt_NotificationStack pattern):**

Add 12-15 line comment on UI layer:
```powerfx
// -----------------------------------------------------------
// PATTERN 1.9: TOAST NOTIFICATION CONTAINER (NEW Phase 4)
// -----------------------------------------------------------
// Renders toast notifications in top-right corner as non-blocking overlay
// Connects to NotificationStack collection managed by App.Formulas layer
//
// Architecture:
// - Parent: cnt_NotificationStack (vertical container, fixed position, high Z-index)
// - Bind to: NotificationStack collection (Layer 2 state)
// - Children: cnt_Toast tiles (repeating, one per notification)
// - Styling: Dynamic via GetToastBackground(), GetToastIcon(), GetToastIconColor()
// - Interaction: Close button calls RemoveToast(ID) to delete specific toast
// - Animation: Slide-in on entrance, fade-out on auto-dismiss exit
//
// Related:
// - Formula layer: App-Formulas-Template.fx (ToastConfig, GetToast*, AddToast/RemoveToast)
// - Initialization: App.OnStart Section 7 (NotificationStack collection setup)
// - Customization: docs/TOAST-NOTIFICATION-GUIDE.md
// - Troubleshooting: docs/TROUBLESHOOTING.md
```

**In Control-Patterns-Modern.fx (lines 650-660, in cnt_Toast pattern, before Visible formula):**

Add 6-8 line comment on auto-dismiss mechanism:
```powerfx
// Auto-Dismiss Mechanism (for toasts with AutoClose=true):
// - Visible property monitors: If(ThisItem.AutoClose && elapsed > 5s, false, true)
// - When elapsed time exceeds configured duration, Visible becomes false
// - Opacity property fades over last 300ms (4.7s-5.0s) for smooth fade-out effect
// - After 5s, toast disappears from screen and should be removed from NotificationStack
// - Error toasts (AutoClose=false) are never hidden by this formula
// - See docs/TROUBLESHOOTING.md#problem-4 if errors auto-dismiss unexpectedly
```

All comments should:
- Start with `//` (Power Fx comment style)
- Be clear and concise (one idea per line, <80 chars)
- Reference line numbers or file names when cross-referencing
- Explain "why" not just "what" (help future developers understand design decisions)
- Include links to related documentation for deeper dives
- Not duplicate existing inline comments (complement them)

Focus on architectural understanding, not implementation details. Developers reading code should understand how notification layers connect without needing external docs.
  </action>
  <verify>
After adding comments to source files:
1. Open App-Formulas-Template.fx and verify:
   - Architecture comment block exists before ToastConfig (lines 878-892)
   - Lifecycle comment block exists after GetToastIcon (lines 955-964)
   - Comments reference all three layers (trigger, state, UI)
   - Comments reference docs/ files for details
2. Open Control-Patterns-Modern.fx and verify:
   - Architecture comment block exists before cnt_NotificationStack (lines 510-524)
   - Auto-dismiss comment block exists in cnt_Toast pattern (lines 650-657)
   - Comments explain relationship to formulas layer
   - Comments are clear and <80 chars per line
3. Verify no existing comments are duplicated (only complement)
4. Verify no technical jargon without explanation
5. Verify cross-references are accurate (file names, line numbers)
  </verify>
  <done>Comprehensive inline comments added to source code explaining notification system architecture, layer relationships, and customization guidance for developers reading code directly</done>
</task>

## Verification

After all tasks complete, verify documentation is complete:

1. **CLAUDE.md expanded:** Notification System section with UDF table, examples, configuration, best practices
2. **QUICK-START.md created:** 5-step guide (clone, connect, configure, verify, test) with <30 min target
3. **TOAST-NOTIFICATION-GUIDE.md created:** Detailed guide with architecture, 4+ examples, customization patterns
4. **TROUBLESHOOTING.md created:** Symptom-based diagnosis for 6+ common issues with solutions
5. **Inline comments added:** App-Formulas-Template.fx and Control-Patterns-Modern.fx documented
6. **All docs cross-reference:** Links between CLAUDE.md, QUICK-START.md, guides, troubleshooting
7. **No broken links:** All references to docs/ files and line numbers accurate
8. **Tone consistent:** All documentation matches existing project tone (practical, helpful, not jargony)

## Success Criteria

1. New developer can understand notification system from CLAUDE.md alone
2. New developer can deploy template in <30 minutes following QUICK-START.md
3. Developer can troubleshoot common issues using TROUBLESHOOTING.md
4. Developer can customize notifications (colors, timing, icons) using TOAST-NOTIFICATION-GUIDE.md
5. Code comments in source files explain "why" notification system is structured as it is
6. All documentation assumes PowerApps connector knowledge (doesn't explain basics)
7. No broken cross-references or inaccurate line numbers
8. Documentation covers all 13 Phase 4 requirements (NOTIF-01 through NOTIF-08, DOC-01 through DOC-05)

## Output

After completion, create `.planning/phases/04-user-experience-documentation/04-03-SUMMARY.md` with:
- Summary of all documentation created
- List of files modified (CLAUDE.md, QUICK-START.md, etc.)
- Key sections added to each file
- Cross-reference map showing how docs link together
- Estimated time for new developer to complete setup (target: <30 min)
- Notes on what documentation assumes (PowerApps knowledge, connector access, etc.)
- Future documentation improvements (v2 enhancements)
