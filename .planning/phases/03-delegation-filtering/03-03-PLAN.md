---
phase: 03-delegation-filtering
plan: 03
type: execute
wave: 2
depends_on: [03-01, 03-02]
files_modified:
  - src/Control-Patterns-Modern.fx
  - src/App-OnStart-Minimal.fx
  - docs/GALLERY-PERFORMANCE.md
autonomous: true

must_haves:
  truths:
    - "Gallery renders 500+ records with smooth scrolling and responsive interaction (<500ms page load)"
    - "Gallery renders first page (50 records) within 1 second on app startup"
    - "Pagination controls (Previous, Next, page number input) work without data loss or delegation warnings"
    - "Switching pages maintains filter state (filters don't reset when paging)"
    - "Page indicator shows accurate page count (e.g., 'Page 3 of 47') calculated correctly"
  artifacts:
    - path: "src/Control-Patterns-Modern.fx"
      provides: "Gallery with FirstN(Skip()) pagination pattern"
      exports: ["Gallery.Items with pagination formula", "Page navigation control patterns"]
    - path: "src/App-OnStart-Minimal.fx"
      provides: "Pagination state variables (CurrentPage, PageSize)"
      exports: ["PageNumber collection or variable", "PageSize set to 50"]
    - path: "docs/GALLERY-PERFORMANCE.md"
      provides: "Gallery performance guide with pagination patterns"
      contains: "FirstN/Skip patterns, page number calculation, pagination UI"
  key_links:
    - from: "Gallery.Items"
      to: "FirstN(Skip(FilteredGalleryData(...), ...))"
      via: "Pagination formula"
      pattern: "FirstN\\(Skip\\(.*?\\*.*?\\).*?PageSize"
    - from: "AppState.CurrentPage"
      to: "Pagination calculation"
      via: "State variable"
      pattern: "\\(AppState\\.CurrentPage.*?-.*?1\\).*?PageSize"
    - from: "btn_NextPage"
      to: "AppState.CurrentPage increment"
      via: "Button OnSelect"
      pattern: "Set\\(AppState.*?CurrentPage.*?\\+.*?1"
    - from: "ActiveFilters (any filter change)"
      to: "AppState.CurrentPage reset to 1"
      via: "Page reset on filter change"
      pattern: "Set\\(AppState.*?CurrentPage.*?1\\)"
---

# Plan 03-03: Gallery Performance & Pagination

## Objective

Validate gallery performance with 500+ records, implement FirstN(Skip()) pagination pattern for non-delegable search operations, and document performance baselines. Ensure galleries remain smooth and responsive even with large filtered datasets.

**Purpose:** Prove that Phase 3 filtering UDFs work at scale without performance degradation, providing confidence for production deployments with >2000 record lists.

**Output:** Gallery control pattern with pagination + performance validation + documentation.

## Execution Context

@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md

## Context

@D:\_Repo\repos\PowerApps-Vibe-Claude\.planning\ROADMAP.md
@D:\_Repo\repos\PowerApps-Vibe-Claude\.planning\phases\03-delegation-filtering\03-CONTEXT.md
@D:\_Repo\repos\PowerApps-Vibe-Claude\.planning\phases\02-performance-foundation\02-03-SUMMARY.md

@D:\_Repo\repos\PowerApps-Vibe-Claude\src\Control-Patterns-Modern.fx
@D:\_Repo\repos\PowerApps-Vibe-Claude\src\App-OnStart-Minimal.fx
@D:\_Repo\repos\PowerApps-Vibe-Claude\CLAUDE.md

## Tasks

<task type="auto">
  <name>Task 1: Implement pagination state variables in App.OnStart</name>
  <files>src/App-OnStart-Minimal.fx</files>
  <action>
Add pagination state variables to App.OnStart after AppState, ActiveFilters, and UIState initialization (around line 80).

Add to AppState schema:

```powerfx
// PAGINATION STATE (for galleries with >2000 record datasets)
AppState: {
  IsInitializing: Boolean,
  UserProfile: Record,
  UserRoles: Record,
  UserPermissions: Record,
  // --- Add these new fields ---
  CurrentPage: Number,          // Current page number (1-based)
  TotalPages: Number,           // Total pages calculated from filtered record count
  PageSize: Number,             // Records per page (set to 50)
  LastFilterChangeTime: DateTime // Timestamp of last filter change (to reset page on filter change)
};
```

Add initialization in App.OnStart Section 0 (Critical Path):

```powerfx
// Initialize pagination after AppState setup
Set(AppState, Patch(AppState, {
  CurrentPage: 1,
  TotalPages: 0,  // Will be calculated based on filtered data
  PageSize: 50,   // Records per page (PERF-05 recommendation)
  LastFilterChangeTime: Now()
}));
```

Add page reset logic to Section 5 or 6 (after filter initialization):

```powerfx
// Reset page to 1 when filters change
// This prevents user from staying on page 47 after applying a restrictive filter
If(
  ActiveFilters <> ThisRecord.LastActiveFilters,
  Set(AppState, Patch(AppState, {
    CurrentPage: 1,
    LastFilterChangeTime: Now()
  })),
  // No change needed
  true
);
```

**Implementation notes:**

1. **CurrentPage:** 1-based numbering (page 1 is first page, not page 0)
2. **PageSize:** Fixed at 50 records per page (configurable in future, but 50 is good default for performance)
3. **LastFilterChangeTime:** Tracks when filters last changed (can be used to detect if page needs reset)
4. **TotalPages:** Calculated dynamically based on filtered dataset size

**Verify:**
- AppState.CurrentPage initializes to 1
- AppState.PageSize initializes to 50
- No errors in formula bar
  </action>
  <verify>
In Power Apps Studio:
1. Open App.OnStart in formula editor
2. Search for "CurrentPage" to find pagination initialization
3. Verify AppState fields exist:
   - [ ] AppState.CurrentPage = 1 initially
   - [ ] AppState.PageSize = 50
   - [ ] AppState.LastFilterChangeTime = Now()
4. Run app (F5 or Play button)
5. In Monitor tool (F12), verify no errors related to pagination variables
6. Check that app starts without errors and AppState initializes correctly
  </verify>
  <done>
- [x] Pagination state variables added to AppState schema (CurrentPage, TotalPages, PageSize, LastFilterChangeTime)
- [x] CurrentPage initialized to 1 (1-based numbering)
- [x] PageSize initialized to 50
- [x] LastFilterChangeTime initialized to Now()
- [x] Page reset logic added (resets to page 1 when filters change)
- [x] No syntax errors in formula editor
- [x] App initializes without errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Gallery.Items pagination pattern to Control-Patterns-Modern.fx</name>
  <files>src/Control-Patterns-Modern.fx</files>
  <action>
Add a complete Gallery pattern section to Control-Patterns-Modern.fx (around line 200) that demonstrates pagination with filtered data.

Add this pattern:

```powerfx
// GALLERY PATTERN: Filtered Gallery with FirstN(Skip()) Pagination
// For galleries with >2000 record datasets, use FirstN(Skip()) for non-delegable operations
//
// Purpose: Show filtered records (role-based, status, search) with pagination
// Page size: 50 records per page (configurable via AppState.PageSize)
// Total pages: Calculated as Ceiling(CountRows(AllFilteredRecords) / PageSize)
//
// Key principle: Filter first, then paginate
// ✓ CORRECT: FirstN(Skip(Filter(...), ...))
// ✗ INCORRECT: Filter(FirstN(Skip(...)), ...) — pagination BEFORE filtering breaks delegation

glr_Items_Pagination_Items_Property: Table =
  FirstN(
    Skip(
      FilteredGalleryData(
        ActiveFilters.ShowMyItemsOnly,
        ActiveFilters.SelectedStatus,
        ActiveFilters.SearchTerm
      ),
      (AppState.CurrentPage - 1) * AppState.PageSize  // Skip previous pages
    ),
    AppState.PageSize  // Show this many records on current page
  );

// Page Number Calculation
// Calculate total pages from filtered dataset
glr_Items_TotalPages_Calculation: Number =
  Ceiling(
    CountRows(
      FilteredGalleryData(
        ActiveFilters.ShowMyItemsOnly,
        ActiveFilters.SelectedStatus,
        ActiveFilters.SearchTerm
      )
    ) / AppState.PageSize
  );

// Page Indicator Label
// Shows "Page N of M" format
lbl_PageIndicator_Text: Text =
  Concatenate("Seite ", AppState.CurrentPage, " von ", glr_Items_TotalPages_Calculation);

// Previous Button OnSelect
btn_Previous_OnSelect: Boolean =
  If(
    AppState.CurrentPage > 1,
    Set(AppState, Patch(AppState, {CurrentPage: AppState.CurrentPage - 1})),
    Notify("Bereits auf der ersten Seite", NotificationType.Information)
  );

// Next Button OnSelect
btn_Next_OnSelect: Boolean =
  If(
    AppState.CurrentPage < glr_Items_TotalPages_Calculation,
    Set(AppState, Patch(AppState, {CurrentPage: AppState.CurrentPage + 1})),
    Notify("Bereits auf der letzten Seite", NotificationType.Information)
  );

// Previous Button Visible (disable if on page 1)
btn_Previous_DisplayMode: DisplayMode =
  If(AppState.CurrentPage > 1, DisplayMode.Edit, DisplayMode.Disabled);

// Next Button Visible (disable if on last page)
btn_Next_DisplayMode: DisplayMode =
  If(AppState.CurrentPage < glr_Items_TotalPages_Calculation, DisplayMode.Edit, DisplayMode.Disabled);

// Clear All Filters Button OnSelect
btn_ClearAll_OnSelect: Boolean =
  Set(ActiveFilters, {
    ShowMyItemsOnly: false,
    SelectedStatus: "",
    SearchTerm: "",
    StartDate: Blank(),
    EndDate: Blank()
  });
  // Note: Page reset to 1 handled automatically via filter change detection in App.OnStart
```

**Implementation notes:**

1. **Gallery.Items formula:** FirstN(Skip(FilteredGalleryData(...), ...))
   - Skip: `(AppState.CurrentPage - 1) * AppState.PageSize` — number of records to skip from start
   - FirstN: `AppState.PageSize` — number of records to show (50)
   - Example: Page 2 of 50 records = Skip(50) records, then take 50 records = records 51-100

2. **Total Pages calculation:** `Ceiling(CountRows(...) / PageSize)`
   - Rounds up (so 105 records = 3 pages, not 2)
   - CountRows() is non-delegable, so call on filtered result (not on 10,000 record datasource)
   - Store in variable or label formula to avoid recalculating repeatedly

3. **Page indicator:** Shows "Page N of M" format (e.g., "Seite 2 von 47")
   - German format: "Seite" (page) and "von" (of)
   - Concatenate() builds the string

4. **Button logic:**
   - Previous: Disabled if on page 1, decrements CurrentPage if clicked
   - Next: Disabled if on last page, increments CurrentPage if clicked
   - Clear All: Resets all filters to blank/false (page reset to 1 happens automatically)

5. **Filter change detection:**
   - When ActiveFilters changes, App.OnStart page reset logic triggers
   - Sets CurrentPage back to 1 (prevents staying on page 47 after applying restrictive filter)

**Important:** CountRows() is called on filtered result, not on full datasource
- ✓ CORRECT: `CountRows(FilteredGalleryData(...))` — counts filtered records only
- ✗ INCORRECT: `CountRows(Items)` — would count ALL records (non-delegable on >2000 record lists)

Verify:
- Formulas compile without errors
- Gallery.Items properly references FilteredGalleryData
- Page calculation logic is correct
- Button OnSelect logic is correct
  </action>
  <verify>
In Power Apps Studio:
1. Open Control-Patterns-Modern.fx in formula editor
2. Search for "glr_Items_Pagination_Items_Property" to find the pattern
3. Verify all formulas are present:
   - [ ] glr_Items_Pagination_Items_Property (Gallery.Items)
   - [ ] glr_Items_TotalPages_Calculation (page count)
   - [ ] lbl_PageIndicator_Text (page label)
   - [ ] btn_Previous_OnSelect (previous button)
   - [ ] btn_Next_OnSelect (next button)
   - [ ] btn_Previous_DisplayMode (previous button visibility)
   - [ ] btn_Next_DisplayMode (next button visibility)
   - [ ] btn_ClearAll_OnSelect (clear filters)
4. Check that glr_Items_Pagination_Items_Property uses FirstN(Skip(FilteredGalleryData(...)))
5. Check that page calculation uses CountRows(FilteredGalleryData(...)) not CountRows(Items)
6. Run app (F5 or Play button)
7. In Monitor tool (F12), verify no errors related to pagination formulas
8. Test pagination:
   - [ ] Navigate to page 2 by clicking Next button
   - [ ] Verify page indicator updates to "Seite 2 von N"
   - [ ] Click Previous button, verify page goes back to 1
   - [ ] Click Clear All, verify filters reset and page resets to 1
  </verify>
  <done>
- [x] Gallery.Items pattern added with FirstN(Skip(FilteredGalleryData(...))) formula
- [x] Page number calculation added: Ceiling(CountRows(FilteredGalleryData(...)) / PageSize)
- [x] Page indicator label formula added: "Seite N von M" format
- [x] Previous button OnSelect with page decrement logic
- [x] Next button OnSelect with page increment logic
- [x] Previous/Next button DisplayMode formulas (disabled at boundaries)
- [x] Clear All button OnSelect with filter reset logic
- [x] Page reset to 1 happens automatically when filters change (via App.OnStart logic)
- [x] All formulas compile without errors
- [x] CountRows() called on filtered result (delegation-safe)
  </done>
</task>

<task type="auto">
  <name>Task 3: Create GALLERY-PERFORMANCE.md documentation</name>
  <files>docs/GALLERY-PERFORMANCE.md</files>
  <action>
Create a new documentation file `docs/GALLERY-PERFORMANCE.md` with comprehensive gallery performance guidance.

File structure:

```markdown
# Gallery Performance & Pagination Patterns

## Overview

This document explains how to implement performant galleries with 500+ records and handle non-delegable operations through pagination.

## Performance Baseline

**Gallery render time (500 records, simple layout):** <1 second
**Page load time (FirstN/Skip pagination, 50 records):** <500ms
**Smooth scrolling:** Maintained at 30+ FPS with responsive interaction

These baselines established in Phase 2-03 (Performance Validation). See PERF-04 requirement.

## When to Use Pagination

### Use FirstN(Skip()) Pagination When:

1. **Large dataset + text search:** Filtering >5000 records with Search() across multiple fields
2. **Large dataset + complex filters:** Multiple filter conditions combined with AND/OR logic
3. **Gallery is slow:** Rendering takes >1 second or scrolling stutters
4. **Delegation warnings in Monitor:** Yellow warnings indicate non-delegable operations

### Don't Need Pagination When:

1. **Dataset <2000 records:** Can use Filter() directly without FirstN/Skip
2. **Simple filter:** Single condition like Status = "Active"
3. **No text search:** Filtering only by status/role/ownership

## FirstN(Skip()) Pagination Pattern

### Basic Pattern

```powerfx
Gallery.Items: Table = FirstN(
  Skip(
    Filter(DataSource, Condition1, Condition2, ...),
    (AppState.CurrentPage - 1) * AppState.PageSize
  ),
  AppState.PageSize
)
```

**Key formula breakdown:**

| Part | What it does | Example |
|------|-------------|---------|
| Filter(...) | Applies all conditions, returns filtered table | Filter(Items, Status="Active") |
| Skip(..., offset) | Skips N records from start of filtered table | Skip(..., 50) = skip first 50 records |
| (CurrentPage-1)*PageSize | Calculates offset: if page=2, pagesize=50, then (2-1)*50=50 | On page 3 of 50: (3-1)*50=100 |
| FirstN(..., count) | Takes N records from current position | FirstN(..., 50) = take next 50 records |

### Example: Showing Pages

| Page | Formula | Records shown |
|------|---------|-----------------|
| 1 | FirstN(Skip(Filter(...), 0), 50) | 1-50 |
| 2 | FirstN(Skip(Filter(...), 50), 50) | 51-100 |
| 3 | FirstN(Skip(Filter(...), 100), 50) | 101-150 |

## Implementation Steps

### Step 1: Add Pagination State Variables

In App.OnStart:

```powerfx
// Add to AppState initialization
Set(AppState, Patch(AppState, {
  CurrentPage: 1,      // Start at page 1
  PageSize: 50,        // Show 50 records per page
  LastFilterChangeTime: Now()
}));
```

### Step 2: Calculate Total Pages

In Gallery label or variable:

```powerfx
// Calculate total pages from filtered dataset
TotalPages: Number = Ceiling(
  CountRows(
    Filter(Items, Status = "Active")  // Use SAME filter conditions as Gallery.Items
  ) / 50  // Divide by page size
);
```

**Critical:** CountRows() should use same Filter() conditions as Gallery.Items.

**Why:** CountRows() is non-delegable, so call it on already-filtered result, not on full datasource.

### Step 3: Set Gallery.Items to Paginated Formula

```powerfx
Gallery.Items: Table = FirstN(
  Skip(
    Filter(Items, Status = "Active"),  // All your filter conditions here
    (AppState.CurrentPage - 1) * 50    // Calculate skip offset
  ),
  50  // Show 50 records per page
)
```

### Step 4: Add Navigation Controls

**Previous Button OnSelect:**
```powerfx
If(
  AppState.CurrentPage > 1,
  Set(AppState, Patch(AppState, {CurrentPage: AppState.CurrentPage - 1})),
  Notify("Bereits auf der ersten Seite", NotificationType.Information)
)
```

**Next Button OnSelect:**
```powerfx
If(
  AppState.CurrentPage < TotalPages,
  Set(AppState, Patch(AppState, {CurrentPage: AppState.CurrentPage + 1})),
  Notify("Bereits auf der letzten Seite", NotificationType.Information)
)
```

**Previous Button DisplayMode (disable at page 1):**
```powerfx
If(AppState.CurrentPage > 1, DisplayMode.Edit, DisplayMode.Disabled)
```

**Next Button DisplayMode (disable at last page):**
```powerfx
If(AppState.CurrentPage < TotalPages, DisplayMode.Edit, DisplayMode.Disabled)
```

### Step 5: Reset Page When Filters Change

Add logic to reset CurrentPage to 1 when filters change:

```powerfx
// In App.OnStart or filter change handler
If(
  ActiveFilters <> PreviousActiveFilters,  // Detect filter change
  Set(AppState, Patch(AppState, {CurrentPage: 1})),  // Reset to page 1
  // No action if filters unchanged
  true
)
```

**Why:** Prevents user from staying on page 47 after applying a filter that results in only 2 pages.

## Using with FilteredGalleryData() Composition

When using the FilteredGalleryData() UDF from Plan 03-02:

```powerfx
// Gallery.Items with pagination
Gallery.Items: Table = FirstN(
  Skip(
    FilteredGalleryData(
      ActiveFilters.ShowMyItemsOnly,
      ActiveFilters.SelectedStatus,
      ActiveFilters.SearchTerm
    ),
    (AppState.CurrentPage - 1) * AppState.PageSize
  ),
  AppState.PageSize
);

// Total pages calculation
TotalPages: Number = Ceiling(
  CountRows(
    FilteredGalleryData(
      ActiveFilters.ShowMyItemsOnly,
      ActiveFilters.SelectedStatus,
      ActiveFilters.SearchTerm
    )
  ) / AppState.PageSize
);
```

**Important:** Use exact same FilteredGalleryData() parameters in both Gallery.Items AND TotalPages calculation.

## Common Mistakes

### Mistake 1: Calling CountRows() on full datasource

```powerfx
// ✗ WRONG: CountRows on 10,000 record list
TotalPages: Number = Ceiling(CountRows(Items) / 50);
```

**Fix:** Count only the filtered result

```powerfx
// ✓ CORRECT: CountRows on filtered result
TotalPages: Number = Ceiling(
  CountRows(
    Filter(Items, Status = "Active")
  ) / 50
);
```

### Mistake 2: Filter() after FirstN(Skip())

```powerfx
// ✗ WRONG: Pagination before filtering breaks delegation
Gallery.Items: Table = Filter(
  FirstN(Skip(Items, 0), 50),
  Status = "Active"
);
```

**Fix:** Filter first, then paginate

```powerfx
// ✓ CORRECT: Filter before pagination
Gallery.Items: Table = FirstN(
  Skip(
    Filter(Items, Status = "Active"),
    0
  ),
  50
);
```

### Mistake 3: Not resetting page on filter change

```powerfx
// ✗ PROBLEM: User on page 10, applies restrictive filter (now only 3 pages)
// Result: Gallery shows blank because CurrentPage (10) > TotalPages (3)
```

**Fix:** Reset CurrentPage to 1 when filters change

```powerfx
// ✓ CORRECT: Detect filter change and reset
If(
  ActiveFilters <> LastActiveFilters,
  Set(AppState, Patch(AppState, {CurrentPage: 1})),
  true
)
```

## Performance Tips

### For Fastest Performance:

1. **Apply most restrictive filter first:** Status usually filters down 80%, so put it first
2. **Skip text search if possible:** Text search is slowest operation
3. **Use FirstN/Skip for large datasets:** Pagination <500ms vs 2+ seconds for full filter
4. **Keep page size around 50:** Too small (10) = many page clicks, too large (500) = slow load

### Monitoring Performance

Use Power Apps Monitor (F12 in Studio):

1. **Check formula timing:** How long does FirstN(Skip()) take?
2. **Check data retrieval:** How long does datasource query take?
3. **Check rendering:** How long does gallery render take?
4. **Look for delegation warnings:** Yellow icon = potential problem

**Target timings:**
- FirstN/Skip calculation: <100ms
- Datasource query: <500ms for filtered 50 records
- Gallery render: <300ms for 50 rows with simple layout

## Testing Pagination

### Test Scenario 1: Normal Pagination

1. Open app, gallery should show page 1 (records 1-50)
2. Click Next, verify gallery shows page 2 (records 51-100)
3. Click Previous, verify page 1 is shown again
4. Page indicator should update correctly ("Seite N von M")

### Test Scenario 2: Filter and Reset Page

1. Navigate to page 3
2. Apply a restrictive filter (e.g., Status="Active" shows only 75 records)
3. Page should reset to 1 automatically
4. Total pages should update (e.g., "Seite 1 von 2" instead of "Seite 1 von 5")

### Test Scenario 3: Text Search

1. Apply text search for "test"
2. Verify gallery shows only matching records
3. Verify page indicator updates based on matching records (not all records)
4. Navigate pages, verify search filter stays applied

### Test Scenario 4: Large Dataset Performance

1. Load app with 5000+ record list
2. Apply multiple filters
3. Verify first page loads in <500ms
4. Verify page navigation is responsive
5. Monitor tool should show no delegation warnings

## FAQ

**Q: Why FirstN/Skip instead of just Filter()?**
A: For large datasets, Filter() with complex conditions becomes non-delegable. FirstN/Skip ensures delegable pagination on top of filtered data.

**Q: Can I use a different page size (not 50)?**
A: Yes! Change AppState.PageSize and update all formulas. 50 is recommended for balance of load time and clicks.

**Q: What if my total page count changes while user is viewing?**
A: This happens when records are added/deleted by other users. Power Apps refreshes automatically. If user is on page 10 and records drop to 5 pages, they'll see blank page until they click Previous.

**Q: Can I show "Jump to page N" input?**
A: Yes, add TextInput where user enters page number, validate 1 <= input <= TotalPages, then Set(AppState.CurrentPage, Value(txt_PageInput)).

**Q: What's the maximum page size I should use?**
A: 50-100 is recommended. Beyond 100, gallery render time increases significantly. Very large pages (1000+) should use virtual scrolling (advanced feature).

---

*Gallery Performance Patterns: Phase 3*
*Last updated: 2026-01-18*
```

Save this file to `docs/GALLERY-PERFORMANCE.md`

**Verify content includes:**
- Performance baseline (500 records, <1 second render)
- When to use pagination (large dataset + search, delegation warnings)
- FirstN/Skip pattern explanation
- Implementation steps (5 steps)
- Using pagination with FilteredGalleryData()
- Common mistakes (CountRows on full table, filter after pagination, no page reset)
- Performance tips (filter ordering, page size)
- Testing scenarios (4 test cases)
- FAQ section (6+ questions)
  </action>
  <verify>
1. Verify file created at D:\_Repo\repos\PowerApps-Vibe-Claude\docs\GALLERY-PERFORMANCE.md
2. Check file contains:
   - [ ] Performance baseline numbers (500 records, <1 second, page load <500ms)
   - [ ] When to use pagination section (large dataset + search, delegation warnings)
   - [ ] Don't need pagination section (dataset <2000, simple filters)
   - [ ] FirstN/Skip pattern explanation with formula breakdown table
   - [ ] Example pages table (page 1-3 with formulas and record ranges)
   - [ ] 5 implementation steps
   - [ ] Step 1: Pagination state variables
   - [ ] Step 2: Total pages calculation with CountRows() on filtered result
   - [ ] Step 3: Gallery.Items FirstN(Skip(...)) formula
   - [ ] Step 4: Navigation controls (Previous/Next OnSelect and DisplayMode)
   - [ ] Step 5: Reset page on filter change
   - [ ] Using with FilteredGalleryData() example
   - [ ] Common mistakes (3 examples with wrong/correct versions)
   - [ ] Performance tips (filter ordering, page size 50)
   - [ ] Monitoring via Power Apps Monitor
   - [ ] Target timings (FirstN <100ms, query <500ms, render <300ms)
   - [ ] 4 test scenarios (normal pagination, filter reset, text search, large dataset)
   - [ ] FAQ section (6+ questions)
3. File is well-structured with markdown headers
4. Code examples use ```powerfx``` syntax highlighting
5. Tables are properly formatted
6. All sections logically organized
  </verify>
  <done>
- [x] GALLERY-PERFORMANCE.md created at D:\_Repo\repos\PowerApps-Vibe-Claude\docs\GALLERY-PERFORMANCE.md
- [x] File contains performance baselines (500 records <1s, page load <500ms)
- [x] File contains when/when-not to use pagination section
- [x] File contains FirstN/Skip pattern explanation with formula breakdown
- [x] File contains example pages table showing record ranges for each page
- [x] File contains 5 implementation steps (state, calculation, Gallery.Items, navigation, reset)
- [x] File contains step-by-step implementation guide
- [x] File contains FilteredGalleryData() integration example
- [x] File contains 3 common mistakes with wrong/correct versions
- [x] File contains performance tips (filter ordering, page size 50)
- [x] File contains Power Apps Monitor guidance
- [x] File contains 4 test scenarios (pagination, filter reset, search, large dataset)
- [x] File contains FAQ section (6+ questions)
- [x] Code examples use proper markdown syntax highlighting
- [x] All sections logically organized with clear headers
  </done>
</task>

</tasks>

## Verification

After executing all 3 tasks:

- [ ] Pagination state variables added to AppState (CurrentPage, PageSize, TotalPages, LastFilterChangeTime)
- [ ] App.OnStart initializes pagination without errors
- [ ] Gallery.Items pattern added to Control-Patterns-Modern.fx with FirstN(Skip()) formula
- [ ] Page calculation formula added using CountRows on filtered result
- [ ] Navigation buttons (Previous, Next, Clear All) added with correct logic
- [ ] Button DisplayMode formulas disable at page boundaries
- [ ] Power Apps Monitor shows no errors related to pagination
- [ ] GALLERY-PERFORMANCE.md created with complete documentation
- [ ] Gallery renders 50 records per page within <500ms
- [ ] Page indicator correctly shows "Seite N von M" format
- [ ] Requirements PERF-04 (500+ record gallery performance) and PERF-05 (pagination documentation) addressed

## Success Criteria

All of the following must be true for this plan to be complete:

1. **Pagination state added:** CurrentPage, PageSize (50), TotalPages, LastFilterChangeTime in AppState
2. **Gallery renders efficiently:** First page loads in <500ms, smooth scrolling with 50 records
3. **Page navigation works:** Previous/Next buttons navigate correctly, disabled at boundaries
4. **Filter state maintained:** Switching pages doesn't reset filters
5. **Page resets on filter change:** Prevents blank gallery when user is on page 10 after restrictive filter applied
6. **Documentation complete:** GALLERY-PERFORMANCE.md includes implementation steps, testing scenarios, and FAQ
7. **Requirements mapped:** PERF-04 (gallery performance) and PERF-05 (pagination patterns documented) both addressed

## Output

After completion, create `.planning/phases/03-delegation-filtering/03-03-SUMMARY.md` documenting:
- Pagination implementation with line numbers
- Gallery render time baseline (should be <1 second for 50 records)
- Performance improvement metrics
- GALLERY-PERFORMANCE.md location and content summary
- Test results for pagination functionality
