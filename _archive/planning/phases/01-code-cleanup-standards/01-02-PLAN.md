---
phase: 01-code-cleanup-standards
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/App-Formulas-Template.fx
  - src/App-OnStart-Minimal.fx
  - src/Control-Patterns-Modern.fx
  - CLAUDE.md
autonomous: true

must_haves:
  truths:
    - "All Named Formulas use PascalCase (ThemeColors, UserProfile, DateRanges)"
    - "All UDFs use PascalCase with verb prefix (HasRole, GetUserScope, FormatDateShort)"
    - "All state variables use PascalCase (AppState, ActiveFilters, UIState)"
    - "All collections use PascalCase with descriptive prefix (CachedDepartments, MyRecentItems)"
    - "Control naming uses abbreviated prefix pattern (glr_, btn_, lbl_, txt_, img_, form_)"
    - "Naming conventions documented in template comments and CLAUDE.md"
  artifacts:
    - path: "src/App-Formulas-Template.fx"
      provides: "Named Formulas and UDFs with standardized naming"
      contains: "// Naming Convention:"
    - path: "src/App-OnStart-Minimal.fx"
      provides: "State variables with standardized naming"
      contains: "// State Variables (PascalCase)"
    - path: "src/Control-Patterns-Modern.fx"
      provides: "Control patterns with abbreviated naming convention"
      contains: "// Control Naming: {Type}_{Name}"
    - path: "CLAUDE.md"
      provides: "Updated naming conventions documentation"
      contains: "## Naming Conventions"
  key_links:
    - from: "CLAUDE.md"
      to: "Template files"
      via: "Documentation references examples"
      pattern: "PascalCase|glr=Gallery|btn=Button"
    - from: "src/App-Formulas-Template.fx"
      to: "src/Control-Patterns-Modern.fx"
      via: "UDF calls use consistent naming"
      pattern: "HasRole|GetUserScope|FormatDateShort"
---

<objective>
Establish consistent naming conventions across all template files to eliminate confusion and enable pattern recognition for developers.

Purpose: Standardize naming for Named Formulas, UDFs, variables, collections, and controls following modern Power Fx best practices, documented in code comments for self-service learning.

Output: Template files with consistent PascalCase naming, abbreviated control prefixes, and comprehensive inline documentation of naming rules.
</objective>

<execution_context>
@D:\_Repo\repos\PowerApps-Vibe-Claude\.claude\workflows\execute-plan.md
@D:\_Repo\repos\PowerApps-Vibe-Claude\.claude\templates\summary.md
</execution_context>

<context>
@D:\_Repo\repos\PowerApps-Vibe-Claude\.planning\PROJECT.md
@D:\_Repo\repos\PowerApps-Vibe-Claude\.planning\ROADMAP.md
@D:\_Repo\repos\PowerApps-Vibe-Claude\.planning\STATE.md
@D:\_Repo\repos\PowerApps-Vibe-Claude\.planning\codebase\CONVENTIONS.md
@D:\_Repo\repos\PowerApps-Vibe-Claude\src\App-Formulas-Template.fx
@D:\_Repo\repos\PowerApps-Vibe-Claude\src\App-OnStart-Minimal.fx
@D:\_Repo\repos\PowerApps-Vibe-Claude\src\Control-Patterns-Modern.fx
@D:\_Repo\repos\PowerApps-Vibe-Claude\CLAUDE.md
</context>

<tasks>

<task type="auto">
  <name>Audit and document Named Formula naming conventions</name>
  <files>src/App-Formulas-Template.fx</files>
  <action>
    Audit all Named Formulas in App-Formulas-Template.fx for PascalCase compliance.

    Expected pattern: PascalCase (first letter uppercase, no underscores, no prefixes)

    Examples from file:
    - ThemeColors ✓
    - Typography ✓
    - Spacing ✓
    - BorderRadius ✓
    - AppConfig ✓
    - UserProfile ✓
    - UserRoles ✓
    - UserPermissions ✓
    - DateRanges ✓

    ACTION:
    1. Scan lines 1-276 (Named Formulas section) for any non-PascalCase names
    2. If all compliant, add comprehensive naming convention header comment after line 16:

    ```powerfx
    // ============================================================
    // NAMING CONVENTIONS IN THIS TEMPLATE
    // ============================================================
    //
    // NAMED FORMULAS: PascalCase (e.g., ThemeColors, UserProfile, DateRanges)
    // - Static configurations and computed values
    // - No verb prefix (these are nouns representing data)
    //
    // USER-DEFINED FUNCTIONS (UDFs): PascalCase with verb prefix
    // - Boolean checks: Has*, Can*, Is* (e.g., HasRole, CanAccessRecord, IsValidEmail)
    // - Retrieval: Get* (e.g., GetUserScope, GetThemeColor)
    // - Formatting: Format* (e.g., FormatDateShort, FormatCurrency)
    // - Actions (Behavior): Notify*, Show*, Update* (e.g., NotifySuccess)
    //
    // Examples:
    // - HasRole("Admin") → Boolean check
    // - GetUserScope() → Retrieval function
    // - FormatDateShort(date) → Formatting function
    // - NotifySuccess("Saved") → Behavior function (Void return)
    //
    // ============================================================
    ```

    3. If any Named Formula is NOT PascalCase, rename it (update all references in file)
  </action>
  <verify>
    Read lines 1-276 of src/App-Formulas-Template.fx.
    Confirm all Named Formulas match PascalCase pattern: [A-Z][a-zA-Z0-9]*
    Confirm naming convention header comment exists after line 16.
    Search entire file for old names if any renames were made (ensure no broken references).
  </verify>
  <done>
    All Named Formulas use PascalCase without underscores or prefixes.
    Header comment documents naming conventions with examples.
    No broken references exist (all renames propagated through file).
  </done>
</task>

<task type="auto">
  <name>Audit and document UDF naming conventions</name>
  <files>src/App-Formulas-Template.fx</files>
  <action>
    Audit all UDFs in App-Formulas-Template.fx for PascalCase with verb prefix compliance.

    Expected patterns:
    - Boolean checks: Has*, Can*, Is*
    - Retrieval: Get*
    - Formatting: Format*
    - Behavior: Notify*, Show*, Update*

    Sample UDFs from file (lines 278-760):
    - HasRole() ✓
    - HasAnyRole() ✓
    - HasAllRoles() ✓
    - HasPermission() ✓
    - CanAccessRecord() ✓
    - CanEditRecord() ✓
    - CanDeleteRecord() ✓
    - GetUserScope() ✓
    - GetDepartmentScope() ✓
    - GetThemeColor() ✓
    - GetStatusColor() ✓
    - GetStatusIcon() ✓
    - GetPriorityColor() ✓
    - NotifySuccess() ✓
    - NotifyError() ✓
    - NotifyWarning() ✓
    - NotifyInfo() ✓
    - NotifyPermissionDenied() ✓
    - NotifyActionCompleted() ✓
    - IsValidEmail() ✓
    - IsOneOf() ✓
    - FormatDateShort() ✓
    - FormatDateLong() ✓
    - FormatDateTimeCET() ✓
    - ConvertUTCToCET() ✓
    - GetCETToday() ✓

    ACTION:
    1. Scan lines 278-760 (UDF section) for any non-compliant names
    2. For each UDF, verify appropriate verb prefix for its purpose:
       - Returns Boolean → should start with Has/Can/Is
       - Returns data → should start with Get
       - Formats output → should start with Format
       - Performs action (Void) → should start with action verb (Notify, Show, Update)

    3. If all compliant, add section header comments for UDF groups:

    ```powerfx
    // -----------------------------------------------------------
    // Permission & Role Check Functions (Has*, Can*)
    // Returns: Boolean
    // -----------------------------------------------------------
    [existing HasRole, HasPermission, CanAccessRecord functions...]

    // -----------------------------------------------------------
    // Data Retrieval Functions (Get*)
    // Returns: Various types (Color, Text, Number, Record)
    // -----------------------------------------------------------
    [existing GetUserScope, GetThemeColor functions...]

    // -----------------------------------------------------------
    // Formatting Functions (Format*)
    // Returns: Text (formatted output)
    // -----------------------------------------------------------
    [existing FormatDateShort, FormatCurrency functions...]

    // -----------------------------------------------------------
    // Validation Functions (Is*)
    // Returns: Boolean
    // -----------------------------------------------------------
    [existing IsValidEmail, IsOneOf functions...]

    // -----------------------------------------------------------
    // Notification Functions (Notify*)
    // Returns: Void (side effects only)
    // Uses: Behavior UDF pattern with curly braces
    // -----------------------------------------------------------
    [existing NotifySuccess, NotifyError functions...]
    ```

    4. If any UDF name is incorrect, rename following verb patterns above
  </action>
  <verify>
    Read lines 278-760 of src/App-Formulas-Template.fx.
    Confirm all UDFs match PascalCase with appropriate verb prefix.
    Confirm section header comments exist grouping UDFs by type.
    Verify Boolean functions use Has/Can/Is prefixes consistently.
    Verify Behavior functions (Void return) use action verb prefixes.
  </verify>
  <done>
    All UDFs use PascalCase with appropriate verb prefix (Has/Can/Is/Get/Format/Notify).
    UDF sections organized with header comments grouping by purpose.
    Verb prefixes match function purpose (Boolean checks vs retrieval vs formatting).
    No broken references after any renames.
  </done>
</task>

<task type="auto">
  <name>Audit and document state variable naming</name>
  <files>src/App-OnStart-Minimal.fx</files>
  <action>
    Audit all state variables in App-OnStart-Minimal.fx for PascalCase compliance.

    Expected pattern: PascalCase (e.g., AppState, ActiveFilters, UIState)

    Existing variables from file:
    - AppState (line 33) ✓
    - ActiveFilters (line 64) ✓
    - UIState (line 90) ✓

    Collection variables:
    - CachedDepartments (line 126) ✓
    - CachedCategories (line 138) ✓
    - CachedStatuses (implied, check if exists) ✓
    - MyRecentItems (check if exists) ✓
    - MyPendingTasks (check if exists) ✓

    ACTION:
    1. Verify all Set() variable names use PascalCase (no underscores, no prefixes like "var" or "g")
    2. Verify all ClearCollect() collection names use PascalCase with descriptive prefix:
       - Cached* for static lookup data
       - My* for user-scoped data
       - Filter* for filtered views (if any)

    3. Add header comment documenting variable naming convention after line 27:

    ```powerfx
    // ============================================================
    // NAMING CONVENTIONS FOR STATE VARIABLES
    // ============================================================
    //
    // STATE VARIABLES (Set): PascalCase
    // - AppState: Application-wide state (loading, navigation, errors)
    // - ActiveFilters: User-modifiable filter state
    // - UIState: UI component state (panels, dialogs, selections)
    //
    // COLLECTIONS (ClearCollect): PascalCase with prefix
    // - Cached*: Static lookup data loaded at startup (e.g., CachedDepartments)
    // - My*: User-scoped data (e.g., MyRecentItems, MyPendingTasks)
    // - Filter*: Filtered views of data (if needed)
    //
    // All variable names must be PascalCase (no underscores, no prefixes)
    //
    // ============================================================
    ```

    4. If any variable uses incorrect naming, rename it (and update all references in Control-Patterns-Modern.fx)
  </action>
  <verify>
    Read src/App-OnStart-Minimal.fx entirely.
    Confirm all Set() variables are PascalCase: AppState, ActiveFilters, UIState.
    Confirm all ClearCollect() collections are PascalCase with appropriate prefix (Cached*, My*).
    Confirm header comment exists documenting variable naming patterns.
    Search Control-Patterns-Modern.fx for variable references to verify no broken references.
  </verify>
  <done>
    All state variables use PascalCase (AppState, ActiveFilters, UIState).
    All collections use PascalCase with descriptive prefix (CachedDepartments, MyRecentItems).
    Header comment documents variable naming convention with examples.
    No broken references in Control-Patterns-Modern.fx after any renames.
  </done>
</task>

<task type="auto">
  <name>Document control naming conventions</name>
  <files>src/Control-Patterns-Modern.fx</files>
  <action>
    Document control naming convention in Control-Patterns-Modern.fx header.

    IMPORTANT: Power Apps controls cannot be renamed in bulk via code. This task documents the STANDARD, it does not rename existing controls in .msapp files.

    Expected pattern: `{AbbreviatedType}_{Name}`

    Abbreviations (from CLAUDE.md):
    - glr = Gallery (e.g., glr_Items, glr_Orders)
    - btn = Button (e.g., btn_Submit, btn_Delete)
    - lbl = Label (e.g., lbl_Title, lbl_Error)
    - txt = TextInput (e.g., txt_Search, txt_Email)
    - img = Image (e.g., img_Logo, img_Avatar)
    - form = Form (e.g., form_EditItem, form_NewOrder)
    - drp = Dropdown (e.g., drp_Status, drp_Category)
    - ico = Icon (e.g., ico_Delete, ico_Edit)
    - cnt = Container (e.g., cnt_Header, cnt_Footer)

    ACTION:
    1. Add comprehensive header comment at top of file (after line 1):

    ```powerfx
    // ============================================================
    // CONTROL PATTERNS - Modern Power Fx 2025
    // ============================================================
    //
    // CONTROL NAMING CONVENTION:
    // {AbbreviatedType}_{Name} (e.g., glr_Orders, btn_Submit, lbl_Status)
    //
    // Standard Abbreviations:
    // - glr = Gallery (e.g., glr_Items, glr_RecentOrders)
    // - btn = Button (e.g., btn_Submit, btn_Delete, btn_Cancel)
    // - lbl = Label (e.g., lbl_Title, lbl_ErrorMessage)
    // - txt = TextInput (e.g., txt_Search, txt_Email, txt_Notes)
    // - img = Image (e.g., img_Logo, img_UserAvatar)
    // - form = Form (e.g., form_EditItem, form_NewRecord)
    // - drp = Dropdown (e.g., drp_Status, drp_Department)
    // - ico = Icon (e.g., ico_Delete, ico_Info, ico_Warning)
    // - cnt = Container (e.g., cnt_Header, cnt_Sidebar)
    // - tog = Toggle (e.g., tog_ActiveOnly, tog_ShowArchived)
    // - chk = Checkbox (e.g., chk_Terms, chk_SelectAll)
    // - dat = DatePicker (e.g., dat_StartDate, dat_DueDate)
    //
    // Benefits of abbreviated prefixes:
    // - Easier to type (3 chars vs 6-10 for full type name)
    // - Consistent length for alignment in formula autocomplete
    // - Clear type indication without verbosity
    //
    // Legacy patterns (AVOID in new code):
    // - Gallery_Items (full type name - too verbose)
    // - Button1, Button2 (auto-generated names - not descriptive)
    // - submitBtn (camelCase - inconsistent with Power Fx conventions)
    //
    // ============================================================
    ```

    2. Update all example control names in patterns to use abbreviated format:
       - Gallery_Orders → glr_Orders
       - Button_Submit → btn_Submit
       - Label_Status → lbl_Status
       - TextInput_Search → txt_Search

    3. Add inline comments documenting naming for each pattern section
  </action>
  <verify>
    Read first 100 lines of src/Control-Patterns-Modern.fx.
    Confirm header comment exists documenting control naming with abbreviation table.
    Scan entire file for example control names.
    Confirm examples use abbreviated format (glr_, btn_, lbl_, txt_, etc.).
    Verify no Gallery_*, Button_*, Label_* patterns remain (all converted to abbreviated).
  </verify>
  <done>
    Header comment documents control naming convention with abbreviation table.
    All example controls use abbreviated format (glr_Orders, btn_Submit, lbl_Status).
    Benefits of abbreviated prefixes documented in header.
    Legacy patterns marked as "AVOID in new code" with explanation.
  </done>
</task>

<task type="auto">
  <name>Update CLAUDE.md naming conventions section</name>
  <files>CLAUDE.md</files>
  <action>
    Update CLAUDE.md section "## Naming Conventions" (lines 41-95) to reflect standardized patterns from template files.

    REPLACE entire section with comprehensive examples:

    ```markdown
    ## Naming Conventions

    ### Power Platform Komponenten
    - **Solutions**: `[Publisher]_[Projektname]_[Typ]` (z.B. `contoso_CRM_Core`)
    - **Tabellen**: PascalCase, Singular (z.B. `Customer`, `OrderItem`)
    - **Spalten**: camelCase mit Präfix (z.B. `cust_firstName`)
    - **Flows**: `[App]-[Aktion]-[Trigger]` (z.B. `CRM-SendEmail-OnCreate`)
    - **Canvas Apps**: `[Bereich]_[Funktion]_App` (z.B. `Sales_OrderEntry_App`)

    ### Power Fx Code

    **Named Formulas:** PascalCase (keine Verben, repräsentieren Daten)
    - ✓ `ThemeColors` - Statische Farbkonfiguration
    - ✓ `UserProfile` - Benutzerprofil-Daten
    - ✓ `DateRanges` - Berechnete Datumsbereiche
    - ✗ `getUserProfile` - camelCase nicht verwenden
    - ✗ `theme_colors` - Underscores nicht verwenden

    **UDFs (User-Defined Functions):** PascalCase mit Verb-Präfix
    - Boolean Checks: `Has*`, `Can*`, `Is*`
      - ✓ `HasRole("Admin")` - Rollenprüfung
      - ✓ `CanAccessRecord(email)` - Zugriffsprüfung
      - ✓ `IsValidEmail(text)` - Validierung
    - Datenabfrage: `Get*`
      - ✓ `GetUserScope()` - Scope abrufen
      - ✓ `GetThemeColor(name)` - Farbe abrufen
    - Formatierung: `Format*`
      - ✓ `FormatDateShort(date)` - Datum formatieren
      - ✓ `FormatCurrency(amount)` - Währung formatieren
    - Aktionen (Behavior): `Notify*`, `Show*`, `Update*`
      - ✓ `NotifySuccess(message)` - Erfolgsmeldung
      - ✓ `ShowErrorDialog(error)` - Fehlerdialog

    **State-Variablen:** PascalCase (keine Präfixe)
    - ✓ `AppState` - Anwendungsstatus
    - ✓ `ActiveFilters` - Aktive Filter
    - ✓ `UIState` - UI-Zustand
    - ✗ `varAppState` - "var" Präfix nicht verwenden
    - ✗ `gActiveFilters` - "g" (global) Präfix nicht verwenden

    **Collections:** PascalCase mit beschreibendem Präfix
    - `Cached*` - Statische Lookup-Daten (z.B. `CachedDepartments`, `CachedStatuses`)
    - `My*` - Benutzerbezogene Daten (z.B. `MyRecentItems`, `MyPendingTasks`)
    - `Filter*` - Gefilterte Ansichten (z.B. `FilteredOrders`)

    **Controls:** Abgekürzter Typ-Präfix + Name
    - `glr_` = Gallery → `glr_Orders`, `glr_RecentItems`
    - `btn_` = Button → `btn_Submit`, `btn_Delete`, `btn_Cancel`
    - `lbl_` = Label → `lbl_Title`, `lbl_ErrorMessage`
    - `txt_` = TextInput → `txt_Search`, `txt_Email`
    - `img_` = Image → `img_Logo`, `img_Avatar`
    - `form_` = Form → `form_EditItem`, `form_NewRecord`
    - `drp_` = Dropdown → `drp_Status`, `drp_Category`
    - `ico_` = Icon → `ico_Delete`, `ico_Warning`
    - `cnt_` = Container → `cnt_Header`, `cnt_Sidebar`
    - `tog_` = Toggle → `tog_ActiveOnly`, `tog_ShowArchived`
    - `chk_` = Checkbox → `chk_Terms`, `chk_SelectAll`
    - `dat_` = DatePicker → `dat_StartDate`, `dat_DueDate`

    **Vorteile der Namenskonventionen:**
    - Typ sofort erkennbar (glr = Gallery, btn = Button)
    - Einfacher zu tippen (3 Zeichen statt 6-10)
    - Konsistente Länge für Autocomplete-Ausrichtung
    - PascalCase folgt Power Fx Konventionen
    - Keine Verwechslung mit Variablen (haben keine Präfixe)

    **Legacy-Muster vermeiden:**
    - ❌ `Gallery_Items` - Voller Typname zu lang
    - ❌ `Button1`, `Button2` - Auto-generierte Namen nicht beschreibend
    - ❌ `submitBtn` - camelCase inkonsistent mit Power Fx
    ```

    Update any other sections referencing naming conventions to match this standard.
  </action>
  <verify>
    Read lines 41-95 of CLAUDE.md (Naming Conventions section).
    Confirm section includes:
    - Named Formulas: PascalCase with examples and anti-patterns
    - UDFs: PascalCase with verb prefix, organized by category (Has/Can/Is/Get/Format/Notify)
    - State Variables: PascalCase with examples of what NOT to do (var, g prefixes)
    - Collections: PascalCase with prefix patterns (Cached*, My*)
    - Controls: Abbreviated prefix table with all common types
    - Benefits section explaining why these conventions
    - Legacy patterns to avoid with explanations
  </verify>
  <done>
    CLAUDE.md Naming Conventions section updated with comprehensive examples.
    All naming patterns documented with ✓ correct and ✗ incorrect examples.
    Control abbreviation table includes all common types (glr, btn, lbl, txt, etc.).
    Benefits and rationale documented for each pattern.
    Legacy patterns explicitly marked as "avoid" with reasons.
  </done>
</task>

</tasks>

<verification>
After implementation, verify naming standardization:

1. **Named Formulas consistency:**
   - Scan App-Formulas-Template.fx lines 1-276
   - All Named Formulas are PascalCase: `[A-Z][a-zA-Z0-9]*`
   - No underscores, no verb prefixes

2. **UDF consistency:**
   - Scan App-Formulas-Template.fx lines 278-760
   - All Boolean functions start with Has/Can/Is
   - All retrieval functions start with Get
   - All formatting functions start with Format
   - All behavior functions start with action verb (Notify, Show, Update)

3. **Variable consistency:**
   - Read App-OnStart-Minimal.fx
   - All Set() variables are PascalCase (AppState, ActiveFilters, UIState)
   - All collections are PascalCase with prefix (CachedDepartments, MyRecentItems)

4. **Documentation completeness:**
   - App-Formulas-Template.fx has naming convention header comment
   - App-OnStart-Minimal.fx has variable naming header comment
   - Control-Patterns-Modern.fx has control naming header with abbreviation table
   - CLAUDE.md has comprehensive naming conventions section with examples

5. **Cross-reference validation:**
   - All UDF calls in Control-Patterns-Modern.fx use correct names from App-Formulas-Template.fx
   - All variable references in Control-Patterns-Modern.fx match names in App-OnStart-Minimal.fx
   - CLAUDE.md examples match actual template code
</verification>

<success_criteria>
1. All Named Formulas follow PascalCase without verb prefixes (nouns representing data)
2. All UDFs follow PascalCase with appropriate verb prefix matching purpose (Has/Can/Is/Get/Format/Notify)
3. All state variables follow PascalCase without prefixes (AppState, ActiveFilters, UIState)
4. All collections follow PascalCase with descriptive prefix (Cached*, My*)
5. Control naming documented with abbreviated prefix pattern (glr_, btn_, lbl_, txt_, etc.)
6. Naming conventions fully documented in template comments and CLAUDE.md with examples and anti-patterns
7. Developer can copy template and understand naming without external documentation
</success_criteria>

<output>
After completion, create `.planning/phases/01-code-cleanup-standards/01-02-SUMMARY.md` documenting:
- Naming audit results (compliant vs non-compliant items found)
- Any renames performed (old name → new name, with reference count)
- Documentation locations (where developers can find naming standards)
- Examples of correct naming patterns from actual template code
</output>
